<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VITA COOP - S∆° ƒë·ªì H·ªá th·ªëng To√†n di·ªán</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow-x: auto;
            padding: 20px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #10b981;
        }

        .header h1 {
            color: #1f2937;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #6b7280;
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #10b981;
            color: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn.active {
            background: #047857;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
        }

        .canvas-container {
            position: relative;
            width: 100%;
            min-height: 800px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
            overflow: auto;
        }

        canvas {
            display: block;
            cursor: move;
        }

        .legend {
            margin-top: 20px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 12px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .instructions {
            margin-top: 20px;
            padding: 15px;
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            border-radius: 8px;
            font-size: 0.9em;
            color: #1e40af;
        }

        .instructions strong {
            display: block;
            margin-bottom: 8px;
            color: #1e3a8a;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 300px;
            display: none;
            z-index: 1000;
        }

        .info-panel.show {
            display: block;
        }

        .info-panel h3 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .info-panel p {
            color: #6b7280;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ef4444;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåø VITA COOP</h1>
            <p>H·ªá Sinh Th√°i R·ª´ng D∆∞·ª£c Sinh Qu·ªëc Gia - S∆° ƒë·ªì H·ªá th·ªëng To√†n di·ªán</p>
        </div>

        <div class="controls">
            <button class="btn active" data-view="overview" onclick="showView('overview', this)">T·ªïng quan</button>
            <button class="btn" data-view="portals" onclick="showView('portals', this)">C√°c Portal</button>
            <button class="btn" data-view="workflows" onclick="showView('workflows', this)">Workflows</button>
            <button class="btn" data-view="architecture" onclick="showView('architecture', this)">Ki·∫øn tr√∫c</button>
            <button class="btn" onclick="resetZoom()">Reset Zoom</button>
        </div>

        <div class="canvas-container">
            <canvas id="systemCanvas"></canvas>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #22c55e;"></div>
                <span>X√£ vi√™n N·ªôi b·ªô</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6;"></div>
                <span>Qu·∫£n tr·ªã HTX</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #a855f7;"></div>
                <span>ƒê·ªëi t√°c H·ªá sinh th√°i</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <span>GreenLight & ƒê·∫ßu t∆∞</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #6366f1;"></div>
                <span>ƒê·∫ßu Ra H·ªá sinh th√°i</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ec4899;"></div>
                <span>Workflows</span>
            </div>
        </div>

        <div class="instructions">
            <strong>üìñ H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</strong>
            <ul style="margin-left: 20px; margin-top: 8px;">
                <li><strong>Click v√†o c√°c n√∫t</strong> ·ªü tr√™n ƒë·ªÉ chuy·ªÉn ƒë·ªïi gi·ªØa c√°c view (T·ªïng quan, C√°c Portal, Workflows, Ki·∫øn tr√∫c)</li>
                <li><strong>Click v√†o c√°c kh·ªëi</strong> tr√™n canvas ƒë·ªÉ xem th√¥ng tin chi ti·∫øt</li>
                <li><strong>K√©o th·∫£</strong> canvas ƒë·ªÉ di chuy·ªÉn xung quanh</li>
                <li><strong>Cu·ªôn chu·ªôt</strong> ƒë·ªÉ zoom in/out</li>
                <li><strong>Reset Zoom</strong> ƒë·ªÉ quay v·ªÅ v·ªã tr√≠ m·∫∑c ƒë·ªãnh</li>
            </ul>
        </div>
    </div>

    <div class="info-panel" id="infoPanel">
        <button class="close-btn" onclick="closeInfoPanel()">√ó</button>
        <h3 id="infoTitle"></h3>
        <p id="infoDescription"></p>
    </div>

    <script>
        const canvas = document.getElementById('systemCanvas');
        const ctx = canvas.getContext('2d');
        const infoPanel = document.getElementById('infoPanel');
        
        let currentView = 'overview';
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let hoveredNode = null;

        // Resize canvas
        function resizeCanvas() {
            const container = canvas.parentElement;
            // Adjust canvas size based on current view
            let minWidth = 2400;
            let minHeight = 1600;
            
            if (currentView === 'portals') {
                minWidth = 2200;
                minHeight = 1200;
            } else if (currentView === 'workflows') {
                minWidth = 1600;
                minHeight = 1200;
            } else if (currentView === 'architecture') {
                minWidth = 1600;
                minHeight = 800;
            }
            
            canvas.width = Math.max(container.clientWidth, minWidth);
            canvas.height = Math.max(container.clientHeight, minHeight);
            draw();
        }

        // Color scheme
        const colors = {
            member: '#22c55e',
            admin: '#3b82f6',
            partner: '#a855f7',
            investment: '#f59e0b',
            output: '#6366f1',
            workflow: '#ec4899',
            greenlight: '#1f2937'
        };

        // System data
        const systemData = {
            overview: {
                nodes: [
                    // X√£ vi√™n N·ªôi b·ªô
                    { id: 'farmer', x: 200, y: 200, w: 180, h: 100, color: colors.member, label: 'N√¥ng d√¢n & C·ªông s·ª±', desc: 'Nh·∫≠t k√Ω canh t√°c ƒëi·ªán t·ª≠ ‚Ä¢ B√°o c√°o s√¢u b·ªánh ‚Ä¢ Quy tr√¨nh k·ªπ thu·∫≠t' },
                    { id: 'resource', x: 200, y: 350, w: 180, h: 100, color: colors.member, label: 'Ch·ªß r·ª´ng & Ch·ªß ƒë·∫•t', desc: 'Qu·∫£n l√Ω t√†i s·∫£n ƒë·∫•t r·ª´ng ‚Ä¢ Gi√°m s√°t h·ªô nh·∫≠n kho√°n ‚Ä¢ V√≠ Carbon' },
                    { id: 'investor_member', x: 200, y: 500, w: 180, h: 100, color: colors.member, label: 'Nh√† ƒë·∫ßu t∆∞ & G√≥p v·ªën', desc: 'Theo d√µi danh m·ª•c ƒë·∫ßu t∆∞ ‚Ä¢ B√°o c√°o t√†i ch√≠nh HTX ‚Ä¢ Nh·∫≠n c·ªï t·ª©c' },
                    
                    // Qu·∫£n tr·ªã HTX
                    { id: 'coop', x: 500, y: 275, w: 180, h: 100, color: colors.admin, label: 'H·ª£p t√°c x√£', desc: 'Qu·∫£n l√Ω danh s√°ch x√£ vi√™n ‚Ä¢ Ph√¢n b·ªï ch·ªâ ti√™u s·∫£n xu·∫•t ‚Ä¢ Qu·∫£n l√Ω kho v·∫≠n' },
                    
                    // ƒê·ªëi t√°c H·ªá sinh th√°i
                    { id: 'research', x: 800, y: 150, w: 180, h: 100, color: colors.partner, label: 'Trung t√¢m Gen & Khoa h·ªçc', desc: 'C·∫•p m√£ ƒë·ªãnh danh ngu·ªìn gi·ªëng ‚Ä¢ C·∫≠p nh·∫≠t quy tr√¨nh canh t√°c (SOP)' },
                    { id: 'expert', x: 800, y: 300, w: 180, h: 100, color: colors.partner, label: 'VITA Expert Hub', desc: 'C·ªïng l√†m vi·ªác chuy√™n gia ‚Ä¢ T∆∞ v·∫•n k·ªπ thu·∫≠t t·ª´ xa ‚Ä¢ K√™ ƒë∆°n s·ªë' },
                    { id: 'gov', x: 800, y: 450, w: 180, h: 100, color: colors.partner, label: 'VITA GOV Portal', desc: 'C·ªïng qu·∫£n tr·ªã s·ªë ch√≠nh quy·ªÅn X√£ ‚Ä¢ Gi√°m s√°t kinh t·∫ø-x√£ h·ªôi' },
                    { id: 'creator', x: 800, y: 600, w: 180, h: 100, color: colors.partner, label: 'VITA Creator Hub', desc: 'C·ªïng KOL/KOC ‚Ä¢ Kho t√†i nguy√™n s·ªë ‚Ä¢ Chi·∫øn d·ªãch Marketing' },
                    
                    // GreenLight & ƒê·∫ßu t∆∞
                    { id: 'greenlight', x: 1100, y: 250, w: 180, h: 100, color: colors.greenlight, label: 'GreenLight Command', desc: 'Dashboard t·ªïng quan h·ªá sinh th√°i ‚Ä¢ Gi√°m s√°t tu√¢n th·ªß & C·∫£nh b√°o r·ªßi ro' },
                    { id: 'investor_portal', x: 1100, y: 400, w: 180, h: 100, color: colors.investment, label: 'Investor Relations Portal', desc: 'Virtual Data Room ‚Ä¢ Valuation Simulator ‚Ä¢ L·ªô tr√¨nh IPO' },
                    
                    // ƒê·∫ßu Ra H·ªá sinh th√°i
                    { id: 'enterprise', x: 1400, y: 200, w: 180, h: 100, color: colors.output, label: 'ƒê·ªëi t√°c Thu mua (B2B)', desc: 'ƒê·∫∑t h√†ng bao ti√™u (Booking) ‚Ä¢ Truy xu·∫•t ngu·ªìn g·ªëc (Traceability)' },
                    { id: 'esg', x: 1400, y: 350, w: 180, h: 100, color: colors.output, label: 'C·ªïng ƒê·∫ßu t∆∞ ESG', desc: 'D·ª± √°n tr·ªìng r·ª´ng ‚Ä¢ T√≠n ch·ªâ Carbon ‚Ä¢ Gi√°m s√°t th·ªùi gian th·ª±c' },
                    { id: 'timber', x: 1400, y: 500, w: 180, h: 100, color: colors.output, label: 'C·ªïng Giao d·ªãch G·ªó', desc: 'ƒê·∫∑t h√†ng r·ª´ng tr·ªìng ‚Ä¢ Ch·ª©ng ch·ªâ FSC/PEFC ‚Ä¢ T√≠nh to√°n hi·ªáu su·∫•t' },
                    { id: 'physician', x: 1400, y: 650, w: 180, h: 100, color: colors.output, label: 'Th·∫ßy thu·ªëc & B·ªánh vi·ªán', desc: 'Tra c·ª©u h·ªì s∆° d∆∞·ª£c li·ªáu ‚Ä¢ G·ª≠i ph·∫£n h·ªìi l√¢m s√†ng ‚Ä¢ ƒê·∫∑t h√†ng thu·ªëc m·∫´u' },
                    
                    // Workflows - Ph·∫ßn 1: Kh·ªüi t·∫°o
                    { id: 'onboarding', x: 200, y: 800, w: 150, h: 80, color: colors.workflow, label: 'Onboarding Gateway', desc: 'C·ªïng ƒëƒÉng k√Ω v√† kh·ªüi t·∫°o' },
                    { id: 'land_digit', x: 400, y: 800, w: 150, h: 80, color: colors.workflow, label: 'Land Digitization', desc: 'S·ªë h√≥a ƒë·∫•t r·ª´ng' },
                    { id: 'seed_listing', x: 600, y: 800, w: 150, h: 80, color: colors.workflow, label: 'Seed Listing', desc: 'ƒêƒÉng k√Ω gi·ªëng c√¢y tr·ªìng' },
                    
                    // Workflows - Ph·∫ßn 2: K√≠ch ho·∫°t Th·ªã tr∆∞·ªùng
                    { id: 'offtake', x: 850, y: 800, w: 150, h: 80, color: colors.workflow, label: 'Offtake Booking', desc: 'ƒê·∫∑t h√†ng bao ti√™u' },
                    { id: 'esg_project', x: 1050, y: 800, w: 150, h: 80, color: colors.workflow, label: 'ESG Project Creation', desc: 'T·∫°o d·ª± √°n ESG' },
                    { id: 'escrow', x: 1250, y: 800, w: 150, h: 80, color: colors.workflow, label: 'Escrow Wallet', desc: 'V√≠ k√Ω qu·ªπ' },
                    { id: 'crowd_invest', x: 1450, y: 800, w: 150, h: 80, color: colors.workflow, label: 'Crowd Investment', desc: 'ƒê·∫ßu t∆∞ c·ªông ƒë·ªìng' },
                    
                    // Workflows - Ph·∫ßn 3: S·∫£n xu·∫•t
                    { id: 'input_sourcing', x: 200, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Input Sourcing', desc: 'T√¨m ngu·ªìn v·∫≠t t∆∞ ƒë·∫ßu v√†o' },
                    { id: 'task_alloc', x: 400, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Task Allocator', desc: 'Ph√¢n b·ªï c√¥ng vi·ªác' },
                    { id: 'monitoring', x: 600, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Monitoring', desc: 'Gi√°m s√°t s·∫£n xu·∫•t' },
                    { id: 'smart_disp', x: 800, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Smart Disbursement', desc: 'Chi tr·∫£ th√¥ng minh' },
                    
                    // Workflows - Ph·∫ßn 4: Thu ho·∫°ch & Th∆∞∆°ng m·∫°i
                    { id: 'digital_harvest', x: 1050, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Digital Harvest', desc: 'Thu ho·∫°ch s·ªë' },
                    { id: 'quality_gate', x: 1250, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Quality Gate', desc: 'C·ªïng ch·∫•t l∆∞·ª£ng' },
                    { id: 'trade_exec', x: 1450, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Trade Execution', desc: 'Th·ª±c thi giao d·ªãch' },
                    { id: 'profit_split', x: 1650, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Profit Split', desc: 'Chia l·ª£i nhu·∫≠n' },
                    { id: 'reinvest', x: 1850, y: 950, w: 150, h: 80, color: colors.workflow, label: 'Reinvestment Loop', desc: 'V√≤ng l·∫∑p t√°i ƒë·∫ßu t∆∞' },
                ],
                connections: [
                    // X√£ vi√™n -> HTX
                    { from: 'farmer', to: 'coop' },
                    { from: 'resource', to: 'coop' },
                    { from: 'investor_member', to: 'coop' },
                    
                    // HTX -> GreenLight
                    { from: 'coop', to: 'greenlight' },
                    
                    // ƒê·ªëi t√°c -> HTX
                    { from: 'research', to: 'coop' },
                    { from: 'expert', to: 'coop' },
                    { from: 'gov', to: 'coop' },
                    
                    // GreenLight -> ƒê·∫ßu ra
                    { from: 'greenlight', to: 'enterprise' },
                    { from: 'greenlight', to: 'esg' },
                    { from: 'greenlight', to: 'timber' },
                    
                    // Workflow connections
                    { from: 'onboarding', to: 'land_digit' },
                    { from: 'land_digit', to: 'seed_listing' },
                    { from: 'seed_listing', to: 'offtake' },
                    { from: 'offtake', to: 'esg_project' },
                    { from: 'esg_project', to: 'escrow' },
                    { from: 'escrow', to: 'input_sourcing' },
                    { from: 'input_sourcing', to: 'task_alloc' },
                    { from: 'task_alloc', to: 'monitoring' },
                    { from: 'monitoring', to: 'smart_disp' },
                    { from: 'smart_disp', to: 'digital_harvest' },
                    { from: 'digital_harvest', to: 'quality_gate' },
                    { from: 'quality_gate', to: 'trade_exec' },
                    { from: 'trade_exec', to: 'profit_split' },
                    { from: 'profit_split', to: 'reinvest' },
                    { from: 'reinvest', to: 'onboarding' },
                ]
            },
            portals: {
                nodes: [
                    // VITA FARMER
                    { id: 'farmer_dash', x: 100, y: 100, w: 200, h: 120, color: colors.member, label: 'Farmer Dashboard', desc: 'Trang ch·ªß n√¥ng d√¢n ‚Ä¢ T·ªïng quan n√¥ng tr·∫°i ‚Ä¢ Th√¥ng b√°o' },
                    { id: 'farmer_diary', x: 100, y: 250, w: 200, h: 120, color: colors.member, label: 'Nh·∫≠t k√Ω ƒêi·ªán t·ª≠', desc: 'Ghi ch√©p canh t√°c ‚Ä¢ B√°o c√°o s√¢u b·ªánh ‚Ä¢ L·ªãch l√†m vi·ªác' },
                    { id: 'farmer_wallet', x: 100, y: 400, w: 200, h: 120, color: colors.member, label: 'V√≠ N√¥ng d√¢n', desc: 'Qu·∫£n l√Ω t√†i ch√≠nh ‚Ä¢ Thanh to√°n ‚Ä¢ L·ªãch s·ª≠ giao d·ªãch' },
                    { id: 'farmer_farm', x: 100, y: 550, w: 200, h: 120, color: colors.member, label: 'Qu·∫£n l√Ω N√¥ng tr·∫°i', desc: 'Th√¥ng tin n√¥ng tr·∫°i ‚Ä¢ Di·ªán t√≠ch ‚Ä¢ C√¢y tr·ªìng' },
                    { id: 'farmer_forestry', x: 100, y: 700, w: 200, h: 120, color: colors.member, label: 'L√¢m nghi·ªáp', desc: 'Qu·∫£n l√Ω r·ª´ng ‚Ä¢ Khai th√°c ‚Ä¢ Ch·ª©ng ch·ªâ' },
                    
                    // VITA ADMIN
                    { id: 'admin_dash', x: 400, y: 100, w: 200, h: 120, color: colors.admin, label: 'Admin Dashboard', desc: 'T·ªïng quan HTX ‚Ä¢ Th·ªëng k√™ ‚Ä¢ B√°o c√°o' },
                    { id: 'admin_gis', x: 400, y: 250, w: 200, h: 120, color: colors.admin, label: 'GIS & B·∫£n ƒë·ªì', desc: 'B·∫£n ƒë·ªì s·ªë ‚Ä¢ Qu·∫£n l√Ω ƒë·∫•t ƒëai ‚Ä¢ Ph√¢n v√πng' },
                    { id: 'admin_warehouse', x: 400, y: 400, w: 200, h: 120, color: colors.admin, label: 'Kho v·∫≠n', desc: 'Qu·∫£n l√Ω kho ‚Ä¢ Nh·∫≠p/Xu·∫•t ‚Ä¢ T·ªìn kho' },
                    { id: 'admin_finance', x: 400, y: 550, w: 200, h: 120, color: colors.admin, label: 'T√†i ch√≠nh', desc: 'K·∫ø to√°n ‚Ä¢ B√°o c√°o t√†i ch√≠nh ‚Ä¢ Thanh to√°n' },
                    { id: 'admin_members', x: 400, y: 700, w: 200, h: 120, color: colors.admin, label: 'X√£ vi√™n', desc: 'Danh s√°ch x√£ vi√™n ‚Ä¢ Qu·∫£n l√Ω th√†nh vi√™n ‚Ä¢ Ph√¢n quy·ªÅn' },
                    { id: 'admin_production', x: 400, y: 850, w: 200, h: 120, color: colors.admin, label: 'S·∫£n xu·∫•t', desc: 'K·∫ø ho·∫°ch s·∫£n xu·∫•t ‚Ä¢ Ph√¢n b·ªï ‚Ä¢ Theo d√µi' },
                    
                    // VITA RESEARCH
                    { id: 'research_lab', x: 700, y: 100, w: 200, h: 120, color: colors.partner, label: 'Research Lab', desc: 'Ph√≤ng th√≠ nghi·ªám s·ªë ‚Ä¢ D·ªØ li·ªáu nghi√™n c·ª©u ‚Ä¢ Th√≠ nghi·ªám' },
                    { id: 'gene_nursery', x: 700, y: 250, w: 200, h: 120, color: colors.partner, label: 'Gene Nursery Hub', desc: 'Qu·∫£n l√Ω gen ‚Ä¢ V∆∞·ªùn ∆∞∆°m ‚Ä¢ Ch·∫•t l∆∞·ª£ng gi·ªëng' },
                    { id: 'seed_marketplace', x: 700, y: 400, w: 200, h: 120, color: colors.partner, label: 'Seed Marketplace', desc: 'S√†n giao d·ªãch gi·ªëng ‚Ä¢ Mua b√°n ‚Ä¢ Truy xu·∫•t' },
                    { id: 'expert_portal', x: 700, y: 550, w: 200, h: 120, color: colors.partner, label: 'Expert Portal', desc: 'C·ªïng chuy√™n gia ‚Ä¢ T∆∞ v·∫•n ‚Ä¢ SOP' },
                    
                    // VITA PARTNER & ENTERPRISE
                    { id: 'partner_dash', x: 1000, y: 100, w: 200, h: 120, color: colors.output, label: 'Partner Dashboard', desc: 'Dashboard ƒë·ªëi t√°c ‚Ä¢ ƒê∆°n h√†ng ‚Ä¢ Th·ªëng k√™' },
                    { id: 'partner_order', x: 1000, y: 250, w: 200, h: 120, color: colors.output, label: 'ƒê·∫∑t h√†ng', desc: 'T·∫°o ƒë∆°n h√†ng ‚Ä¢ Theo d√µi ‚Ä¢ Qu·∫£n l√Ω' },
                    { id: 'partner_trace', x: 1000, y: 400, w: 200, h: 120, color: colors.output, label: 'Traceability', desc: 'Truy xu·∫•t ngu·ªìn g·ªëc ‚Ä¢ QR Code ‚Ä¢ L·ªãch s·ª≠' },
                    { id: 'enterprise_proc', x: 1000, y: 550, w: 200, h: 120, color: colors.output, label: 'Enterprise Procurement', desc: 'Mua s·∫Øm doanh nghi·ªáp ‚Ä¢ ƒê·∫•u th·∫ßu ‚Ä¢ H·ª£p ƒë·ªìng' },
                    { id: 'enterprise_match', x: 1000, y: 700, w: 200, h: 120, color: colors.output, label: 'Enterprise Matching', desc: 'Kh·ªõp ƒë∆°n h√†ng ‚Ä¢ T√¨m ƒë·ªëi t√°c ‚Ä¢ ƒê√†m ph√°n' },
                    
                    // INVESTMENT PORTALS
                    { id: 'investor_portal_detail', x: 1300, y: 100, w: 200, h: 120, color: colors.investment, label: 'Investor Portal', desc: 'Quan h·ªá nh√† ƒë·∫ßu t∆∞ ‚Ä¢ Valuation ‚Ä¢ IPO' },
                    { id: 'esg_portal_detail', x: 1300, y: 250, w: 200, h: 120, color: colors.investment, label: 'ESG Portal', desc: 'ƒê·∫ßu t∆∞ t√°c ƒë·ªông ‚Ä¢ Carbon ‚Ä¢ B√°o c√°o ESG' },
                    { id: 'timber_trading_detail', x: 1300, y: 400, w: 200, h: 120, color: colors.investment, label: 'Timber Trading', desc: 'Giao d·ªãch g·ªó ‚Ä¢ FSC/PEFC ‚Ä¢ Khai th√°c' },
                    
                    // GOVERNMENT & OTHERS
                    { id: 'gov_portal_detail', x: 1600, y: 100, w: 200, h: 120, color: colors.partner, label: 'Gov Portal', desc: 'X√£ N√¥ng Th√¥n M·ªõi S·ªë ‚Ä¢ Qu·∫£n l√Ω ƒë·ªãa ph∆∞∆°ng' },
                    { id: 'physician_portal_detail', x: 1600, y: 250, w: 200, h: 120, color: colors.output, label: 'Physician Portal', desc: 'Ki·ªÉm ƒë·ªãnh ‚Ä¢ L√¢m s√†ng ‚Ä¢ D∆∞·ª£c li·ªáu' },
                    { id: 'creator_hub_detail', x: 1600, y: 400, w: 200, h: 120, color: colors.partner, label: 'Creator Hub', desc: 'KOL/KOC ‚Ä¢ Marketing ‚Ä¢ Content' },
                    { id: 'greenlight_detail', x: 1600, y: 550, w: 200, h: 120, color: colors.greenlight, label: 'GreenLight Command', desc: 'ƒêi·ªÅu h√†nh h·ªá th·ªëng ‚Ä¢ Gi√°m s√°t ‚Ä¢ B√°o c√°o' },
                ],
                connections: [
                    // Farmer connections
                    { from: 'farmer_dash', to: 'farmer_diary' },
                    { from: 'farmer_dash', to: 'farmer_wallet' },
                    { from: 'farmer_dash', to: 'farmer_farm' },
                    { from: 'farmer_farm', to: 'farmer_forestry' },
                    
                    // Admin connections
                    { from: 'admin_dash', to: 'admin_gis' },
                    { from: 'admin_dash', to: 'admin_warehouse' },
                    { from: 'admin_dash', to: 'admin_finance' },
                    { from: 'admin_dash', to: 'admin_members' },
                    { from: 'admin_dash', to: 'admin_production' },
                    
                    // Research connections
                    { from: 'research_lab', to: 'gene_nursery' },
                    { from: 'gene_nursery', to: 'seed_marketplace' },
                    { from: 'expert_portal', to: 'research_lab' },
                    
                    // Partner connections
                    { from: 'partner_dash', to: 'partner_order' },
                    { from: 'partner_order', to: 'partner_trace' },
                    { from: 'enterprise_proc', to: 'enterprise_match' },
                    
                    // Investment connections
                    { from: 'investor_portal_detail', to: 'esg_portal_detail' },
                    { from: 'esg_portal_detail', to: 'timber_trading_detail' },
                    
                    // Cross connections
                    { from: 'admin_dash', to: 'greenlight_detail' },
                    { from: 'farmer_dash', to: 'admin_dash' },
                    { from: 'seed_marketplace', to: 'farmer_farm' },
                ]
            },
            workflows: {
                nodes: [
                    // Ph·∫ßn 1: Kh·ªüi t·∫°o & S·ªë h√≥a
                    { id: 'w1_onboarding', x: 200, y: 200, w: 180, h: 100, color: colors.workflow, label: 'Onboarding Gateway', desc: 'C·ªïng ƒëƒÉng k√Ω ‚Ä¢ Ch·ªçn vai tr√≤ ‚Ä¢ Kh·ªüi t·∫°o t√†i kho·∫£n' },
                    { id: 'w1_land', x: 450, y: 200, w: 180, h: 100, color: colors.workflow, label: 'Land Digitization', desc: 'S·ªë h√≥a ƒë·∫•t r·ª´ng ‚Ä¢ GPS ‚Ä¢ B·∫£n ƒë·ªì s·ªë' },
                    { id: 'w1_seed', x: 700, y: 200, w: 180, h: 100, color: colors.workflow, label: 'Seed Listing', desc: 'ƒêƒÉng k√Ω gi·ªëng ‚Ä¢ M√£ gen ‚Ä¢ Ch·ª©ng nh·∫≠n' },
                    
                    // Ph·∫ßn 2: K√≠ch ho·∫°t Th·ªã tr∆∞·ªùng
                    { id: 'w2_offtake', x: 200, y: 400, w: 180, h: 100, color: colors.workflow, label: 'Offtake Booking', desc: 'ƒê·∫∑t h√†ng bao ti√™u ‚Ä¢ H·ª£p ƒë·ªìng ‚Ä¢ Cam k·∫øt' },
                    { id: 'w2_esg', x: 450, y: 400, w: 180, h: 100, color: colors.workflow, label: 'ESG Project Creation', desc: 'T·∫°o d·ª± √°n ESG ‚Ä¢ Carbon ‚Ä¢ T√°c ƒë·ªông' },
                    { id: 'w2_escrow', x: 700, y: 400, w: 180, h: 100, color: colors.workflow, label: 'Escrow Wallet', desc: 'V√≠ k√Ω qu·ªπ ‚Ä¢ Thanh to√°n ‚Ä¢ B·∫£o ƒë·∫£m' },
                    { id: 'w2_crowd', x: 950, y: 400, w: 180, h: 100, color: colors.workflow, label: 'Crowd Investment', desc: 'ƒê·∫ßu t∆∞ c·ªông ƒë·ªìng ‚Ä¢ G√≥p v·ªën ‚Ä¢ ROI' },
                    
                    // Ph·∫ßn 3: S·∫£n xu·∫•t & Gi√°m s√°t
                    { id: 'w3_input', x: 200, y: 600, w: 180, h: 100, color: colors.workflow, label: 'Input Sourcing', desc: 'T√¨m ngu·ªìn v·∫≠t t∆∞ ‚Ä¢ ƒê·∫∑t h√†ng ‚Ä¢ Nh·∫≠p kho' },
                    { id: 'w3_task', x: 450, y: 600, w: 180, h: 100, color: colors.workflow, label: 'Task Allocator', desc: 'Ph√¢n b·ªï c√¥ng vi·ªác ‚Ä¢ L·ªãch tr√¨nh ‚Ä¢ Nh√¢n s·ª±' },
                    { id: 'w3_monitor', x: 700, y: 600, w: 180, h: 100, color: colors.workflow, label: 'Monitoring', desc: 'Gi√°m s√°t s·∫£n xu·∫•t ‚Ä¢ IoT ‚Ä¢ B√°o c√°o' },
                    { id: 'w3_disp', x: 950, y: 600, w: 180, h: 100, color: colors.workflow, label: 'Smart Disbursement', desc: 'Chi tr·∫£ th√¥ng minh ‚Ä¢ T·ª± ƒë·ªông ‚Ä¢ Minh b·∫°ch' },
                    
                    // Ph·∫ßn 4: Thu ho·∫°ch & Th∆∞∆°ng m·∫°i
                    { id: 'w4_harvest', x: 200, y: 800, w: 180, h: 100, color: colors.workflow, label: 'Digital Harvest', desc: 'Thu ho·∫°ch s·ªë ‚Ä¢ Ghi nh·∫≠n ‚Ä¢ Ch·ª©ng nh·∫≠n' },
                    { id: 'w4_quality', x: 450, y: 800, w: 180, h: 100, color: colors.workflow, label: 'Quality Gate', desc: 'Ki·ªÉm tra ch·∫•t l∆∞·ª£ng ‚Ä¢ Ch·ª©ng nh·∫≠n ‚Ä¢ Ph√™ duy·ªát' },
                    { id: 'w4_trade', x: 700, y: 800, w: 180, h: 100, color: colors.workflow, label: 'Trade Execution', desc: 'Th·ª±c thi giao d·ªãch ‚Ä¢ Giao h√†ng ‚Ä¢ Thanh to√°n' },
                    { id: 'w4_profit', x: 950, y: 800, w: 180, h: 100, color: colors.workflow, label: 'Profit Split', desc: 'Chia l·ª£i nhu·∫≠n ‚Ä¢ T·ª± ƒë·ªông ‚Ä¢ C√¥ng b·∫±ng' },
                    { id: 'w4_reinvest', x: 1200, y: 800, w: 180, h: 100, color: colors.workflow, label: 'Reinvestment Loop', desc: 'T√°i ƒë·∫ßu t∆∞ ‚Ä¢ V√≤ng l·∫∑p ‚Ä¢ M·ªü r·ªông' },
                ],
                connections: [
                    // Ph·∫ßn 1
                    { from: 'w1_onboarding', to: 'w1_land' },
                    { from: 'w1_land', to: 'w1_seed' },
                    
                    // Ph·∫ßn 2
                    { from: 'w1_seed', to: 'w2_offtake' },
                    { from: 'w2_offtake', to: 'w2_esg' },
                    { from: 'w2_esg', to: 'w2_escrow' },
                    { from: 'w2_esg', to: 'w2_crowd' },
                    
                    // Ph·∫ßn 3
                    { from: 'w2_escrow', to: 'w3_input' },
                    { from: 'w3_input', to: 'w3_task' },
                    { from: 'w3_task', to: 'w3_monitor' },
                    { from: 'w3_monitor', to: 'w3_disp' },
                    
                    // Ph·∫ßn 4
                    { from: 'w3_disp', to: 'w4_harvest' },
                    { from: 'w4_harvest', to: 'w4_quality' },
                    { from: 'w4_quality', to: 'w4_trade' },
                    { from: 'w4_trade', to: 'w4_profit' },
                    { from: 'w4_profit', to: 'w4_reinvest' },
                    { from: 'w4_reinvest', to: 'w1_onboarding' },
                ]
            },
            architecture: {
                nodes: [
                    // Frontend Layer
                    { id: 'frontend', x: 200, y: 100, w: 300, h: 150, color: '#61dafb', label: 'Frontend Layer\nReact + TypeScript', desc: 'React Application ‚Ä¢ React Router ‚Ä¢ UI Components ‚Ä¢ i18next' },
                    { id: 'state', x: 600, y: 100, w: 250, h: 150, color: '#764ba2', label: 'State Management', desc: 'Local State ‚Ä¢ React Hooks ‚Ä¢ Context API' },
                    
                    // Backend Services
                    { id: 'firebase', x: 200, y: 350, w: 200, h: 120, color: '#ffca28', label: 'Firebase', desc: 'Authentication ‚Ä¢ Storage ‚Ä¢ Real-time' },
                    { id: 'supabase', x: 450, y: 350, w: 200, h: 120, color: '#3ecf8e', label: 'Supabase', desc: 'Database ‚Ä¢ Realtime ‚Ä¢ Storage' },
                    { id: 'stripe', x: 700, y: 350, w: 200, h: 120, color: '#635bff', label: 'Stripe', desc: 'Payment Processing ‚Ä¢ Subscriptions' },
                    
                    // External Services
                    { id: 'maps', x: 200, y: 550, w: 180, h: 100, color: '#4285f4', label: 'GIS/Maps APIs', desc: 'Google Maps ‚Ä¢ OpenStreetMap ‚Ä¢ GIS' },
                    { id: 'payment', x: 450, y: 550, w: 180, h: 100, color: '#00d4aa', label: 'Payment Gateways', desc: 'VNPay ‚Ä¢ MoMo ‚Ä¢ Banking' },
                    { id: 'notification', x: 700, y: 550, w: 180, h: 100, color: '#ff6b6b', label: 'Push Notifications', desc: 'Firebase Cloud Messaging ‚Ä¢ Web Push' },
                    
                    // Data Layer
                    { id: 'database', x: 950, y: 350, w: 200, h: 120, color: '#10b981', label: 'Database', desc: 'PostgreSQL ‚Ä¢ Real-time ‚Ä¢ Queries' },
                    { id: 'storage', x: 950, y: 550, w: 200, h: 100, color: '#f59e0b', label: 'File Storage', desc: 'Images ‚Ä¢ Documents ‚Ä¢ Media' },
                    
                    // Security & Auth
                    { id: 'auth', x: 1200, y: 200, w: 200, h: 120, color: '#ef4444', label: 'Authentication', desc: 'JWT ‚Ä¢ OAuth ‚Ä¢ Session Management' },
                    { id: 'security', x: 1200, y: 400, w: 200, h: 120, color: '#8b5cf6', label: 'Security', desc: 'Encryption ‚Ä¢ HTTPS ‚Ä¢ CORS ‚Ä¢ Validation' },
                ],
                connections: [
                    { from: 'frontend', to: 'state' },
                    { from: 'frontend', to: 'firebase' },
                    { from: 'frontend', to: 'supabase' },
                    { from: 'frontend', to: 'stripe' },
                    { from: 'frontend', to: 'auth' },
                    { from: 'firebase', to: 'maps' },
                    { from: 'firebase', to: 'notification' },
                    { from: 'supabase', to: 'database' },
                    { from: 'supabase', to: 'storage' },
                    { from: 'stripe', to: 'payment' },
                    { from: 'auth', to: 'security' },
                ]
            }
        };

        function drawNode(node) {
            const x = node.x * scale + offsetX;
            const y = node.y * scale + offsetY;
            const w = node.w * scale;
            const h = node.h * scale;

            // Check if node is hovered
            const isHovered = hoveredNode === node.id;
            
            // Draw shadow
            ctx.shadowColor = 'rgba(0,0,0,0.2)';
            ctx.shadowBlur = isHovered ? 15 : 8;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 4;

            // Draw rounded rectangle
            ctx.fillStyle = node.color;
            ctx.strokeStyle = isHovered ? '#ffffff' : node.color;
            ctx.lineWidth = isHovered ? 3 : 2;
            
            roundRect(ctx, x, y, w, h, 12);
            ctx.fill();
            ctx.stroke();

            // Reset shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;

            // Draw label
            ctx.fillStyle = '#ffffff';
            ctx.font = `bold ${Math.max(12, 14 * scale)}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Split label into lines if needed
            const words = node.label.split(' ');
            const lines = [];
            let currentLine = '';
            
            words.forEach(word => {
                const testLine = currentLine + (currentLine ? ' ' : '') + word;
                const metrics = ctx.measureText(testLine);
                if (metrics.width > w - 20 && currentLine) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine = testLine;
                }
            });
            if (currentLine) lines.push(currentLine);
            
            const lineHeight = 18 * scale;
            const startY = y + h / 2 - (lines.length - 1) * lineHeight / 2;
            
            lines.forEach((line, i) => {
                ctx.fillText(line, x + w / 2, startY + i * lineHeight);
            });
        }

        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
            ctx.lineTo(x + radius, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
            ctx.lineTo(x, y + radius);
            ctx.quadraticCurveTo(x, y, x + radius, y);
            ctx.closePath();
        }

        function drawConnection(conn) {
            const fromNode = systemData[currentView].nodes.find(n => n.id === conn.from);
            const toNode = systemData[currentView].nodes.find(n => n.id === conn.to);
            
            if (!fromNode || !toNode) return;

            const fromX = fromNode.x * scale + offsetX + fromNode.w * scale / 2;
            const fromY = fromNode.y * scale + offsetY + fromNode.h * scale / 2;
            const toX = toNode.x * scale + offsetX + toNode.w * scale / 2;
            const toY = toNode.y * scale + offsetY + toNode.h * scale / 2;

            ctx.strokeStyle = 'rgba(107, 114, 128, 0.3)';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            
            ctx.setLineDash([]);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const data = systemData[currentView];
            if (!data) return;

            // Draw connections first (behind nodes)
            data.connections.forEach(conn => drawConnection(conn));

            // Draw nodes
            data.nodes.forEach(node => drawNode(node));

            // Draw title
            ctx.fillStyle = '#1f2937';
            ctx.font = 'bold 24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(getViewTitle(), canvas.width / 2, 40);
        }

        function getViewTitle() {
            const titles = {
                overview: 'T·ªïng quan H·ªá th·ªëng VITA COOP',
                portals: 'C√°c Portal & Ng∆∞·ªùi d√πng',
                workflows: 'Workflows & Quy tr√¨nh',
                architecture: 'Ki·∫øn tr√∫c H·ªá th·ªëng'
            };
            return titles[currentView] || 'VITA COOP System';
        }

        function showView(view, buttonElement) {
            currentView = view;
            
            // Update button states
            document.querySelectorAll('.btn[data-view]').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Reset view
            scale = 1;
            offsetX = 0;
            offsetY = 0;
            
            // Resize canvas for new view
            resizeCanvas();
        }

        function resetZoom() {
            scale = 1;
            offsetX = 0;
            offsetY = 0;
            draw();
        }

        // Mouse events
        canvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            
            // Check for node click
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left - offsetX) / scale;
            const mouseY = (e.clientY - rect.top - offsetY) / scale;
            
            const data = systemData[currentView];
            if (data) {
                const clickedNode = data.nodes.find(node => {
                    return mouseX >= node.x && mouseX <= node.x + node.w &&
                           mouseY >= node.y && mouseY <= node.y + node.h;
                });
                
                if (clickedNode) {
                    showInfoPanel(clickedNode);
                }
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left - offsetX) / scale;
            const mouseY = (e.clientY - rect.top - offsetY) / scale;
            
            // Check hover
            const data = systemData[currentView];
            if (data) {
                const hovered = data.nodes.find(node => {
                    return mouseX >= node.x && mouseX <= node.x + node.w &&
                           mouseY >= node.y && mouseY <= node.y + node.h;
                });
                
                if (hovered) {
                    hoveredNode = hovered.id;
                    canvas.style.cursor = 'pointer';
                } else {
                    hoveredNode = null;
                    canvas.style.cursor = isDragging ? 'grabbing' : 'move';
                }
            }
            
            if (isDragging) {
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                offsetX += deltaX;
                offsetY += deltaY;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                draw();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
            hoveredNode = null;
            draw();
        });

        // Zoom with mouse wheel
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = Math.max(0.5, Math.min(2, scale * zoomFactor));
            
            offsetX = mouseX - (mouseX - offsetX) * (newScale / scale);
            offsetY = mouseY - (mouseY - offsetY) * (newScale / scale);
            scale = newScale;
            
            draw();
        });

        function showInfoPanel(node) {
            document.getElementById('infoTitle').textContent = node.label;
            document.getElementById('infoDescription').textContent = node.desc;
            infoPanel.classList.add('show');
        }

        function closeInfoPanel() {
            infoPanel.classList.remove('show');
        }

        // Initialize
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        draw();
    </script>
</body>
</html>
